<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <link rel="icon" href="<%= BASE_URL %>favicon.ico">
    <link rel="stylesheet" href="https://cdn.bootcss.com/material-design-icons/3.0.1/iconfont/material-icons.css">
    <title>education-wechat</title>
  </head>
  <body>
    <noscript>
      <strong>We're sorry but education-wechat doesn't work properly without JavaScript enabled. Please enable it to continue.</strong>
    </noscript>
    <div id="app"></div>
    <script>
      (function () {
        const openid = localStorage.getItem('openid');
        // 如果本地有openid就已经授权了不用再授权
        if (openid) {
          return;
        }
         const appId = 'wx6bce565776a81ced';
         const scope = 'snsapi_base'; // 授权方式静默授权
        // 是否有code码
        const {
          href,
          search,
        } = location;

        // 假如没有search，或者没有code，就去授权
        if (!search || !search.includes('code')) {
          // 这里的url需要转为加密格式，它的作用是访问微信网页鉴权接口成功后微信会回调这个地址，并把code参数带在回调地址中
          const redirectUri = encodeURIComponent(href);
          const url = `https://open.weixin.qq.com/connect/oauth2/authorize?appid=${appId}&redirect_uri=${redirectUri}&response_type=code&scope=${scope}&state=STATE&connect_redirect=1#wechat_redirect`;
          // 跳转路由
          location.replace(url);
        } else {
          // 微信授权回来
          // ?code=021LfE0Z0w4UHV1neFZY0RYu0Z0LfE05&state=STATE
          console.log(search);
        }
      })()
    </script>
    <!-- built files will be auto injected -->
  </body>
</html>
